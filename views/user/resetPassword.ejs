<%- include('../partials/user/header') %>
<!DOCTYPE html>

    <style>
        
        .resetpswd-form-main-container{
            background-image: url('../images/Download\ Abstract\ hexagonal\ molecular\ structures\ background\ with\ copy\ spa\ for\ free.jpeg'); /* Replace with the actual image path */
            background-size: cover; /* Ensures the image covers the entire container */
            background-position: center; /* Centers the background image */
            padding: 40px;
            border-radius: 10px; /* Optional: Adds rounded corners */
        }
        .resetpswd-form-container {
            background-color: #fff;
            padding: 20px;
            max-width: 400px;
            margin: 0 auto;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .resetpswd-form-container h2 {
            text-align: center;
            margin-bottom: 20px;
        }
        .resetpswd-form-group {
            margin-bottom: 15px;
        }
        .resetpswd-form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .resetpswd-form-group {
        position: relative; /* To position the eye icon inside the input */
        }
        .resetpswd-form-group input {
            width: 100%;
            padding: 10px;
            font-size: 16px;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding-right: 40px;
        }
        .resetpswd-submit-btn {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
        }
        .resetpswd-submit-btn:hover {
            background-color: #218838;
        }
        .resetpswd-error {
            color: red;
            font-size: 14px;
        }
        .eye-icon {
            position: absolute;
            right: 10px;
            top: 68%;
            transform: translateY(-50%);
            cursor: pointer;
        }
    </style>

<div class="resetpswd-form-main-container">
    <div class="resetpswd-form-container">
        <h2>Reset Password</h2>
        <form id="resetpswdForm" action="/myAccount/resetPassword" method="POST">
            <div class="resetpswd-form-group">
                <label for="resetpswdOldPassword">Old Password</label>
                <input type="password" id="resetpswdOldPassword" name="oldPassword" >
                <div id="error1"></div>
            </div>
    
            <div class="resetpswd-form-group">
                <label for="resetpswdNewPassword">New Password</label>
                <input type="password" id="resetpswdNewPassword" name="newPassword" disabled>
                <span id="eyeIcon" class="eye-icon"><i class="fa-solid fa-eye fa-sm"></i></span>
                <div id="error2"></div>
            </div>
    
            <div class="resetpswd-form-group">
                <label for="resetpswdConfirmPassword">Confirm New Password</label>
                <input type="password" id="resetpswdConfirmPassword" name="confirmPassword" disabled>
                
                <div id="error3"></div>
            </div>
            <div id="error4"></div>
            <button type="submit" class="resetpswd-submit-btn">Reset Password</button>
        </form>
    </div>
</div>




<script>
    const form = document.getElementById('resetpswdForm');
    const newPassword = document.getElementById('resetpswdNewPassword');
    const confirmPassword = document.getElementById('resetpswdConfirmPassword');
    const error3 = document.getElementById('error3');
    const error2=document.getElementById('error2')
    const error4=document.getElementById('error4')
    const eyeIcon=document.getElementById('eyeIcon')
    const oldPassword=document.getElementById('resetpswdOldPassword')
    const error1=document.getElementById('error1')

    oldPassword.addEventListener('blur',async function(){
        const oldPasswordVal=oldPassword.value 

        if(oldPasswordVal.length > 0){
        try {
            const response=await fetch('/myAccount/resetPassword/checkPassword',{
                method:"POST",
                headers:{
                    'Content-Type': 'application/json',
                },
                body:JSON.stringify({oldPassword:oldPasswordVal})
            })
            
                const data=await response.json()
                if(data.isValid){
                    error1.innerHTML="password is correct"
                    error1.style.color="green"
                    newPassword.disabled=false
                    confirmPassword.disabled=false
                    oldPassword.disabled=true

                }else{
                    error1.innerHTML="password is incorrect"
                    error1.style.color="red"
                    newPassword.disabled=true
                    confirmPassword.disabled=true
                }
        } catch (error) {
            console.log("error in password varification")
        }   
        }else{
            error1.innerHTML=""
        }
    })

    
</script>

<script>
    function passwordValidation(){
        const passwordVal=newPassword.value;
        const passwordPattern=/^(?=.*[a-zA-Z])(?=.*\d)(?=.*[@$!%*?&#])[A-Za-z\d@$!%*?&#]{8,}$/


        if(!passwordPattern.test(passwordVal)){
            
            error2.innerHTML="password not strong enogh"
            error2.style.color="red"
            return false
        }
        else{
            
            error2.innerHTML=""
            return true
        }
    }
    function confirmPasswordValidation(){

        if (newPassword.value !== confirmPassword.value) {
            
            error3.innerHTML= "Passwords do not match!";
            error3.style.color="red"
            return false
        } else {
            error3.innerHTML = ""; // Clear error if passwords match
            return true
        }
    }

    function desabledChecking(){

        if(newPassword.disabled || confirmPassword.disabled){
            error4.innerHTML= "enter required inputs";
            error4.style.color="red"
            return false
        }else{
            error4.innerHTML=""
            return true
        }
    }

    document.addEventListener("DOMContentLoaded",()=>{
        form.addEventListener('submit', function (event) {

           const isPassword=passwordValidation()
           const isConfirmpswd=confirmPasswordValidation()
           const isDesabled=desabledChecking()


            if(!isPassword || !isConfirmpswd || !isDesabled ){
                event.preventDefault()
            }

        
    });
    })

    eyeIcon.addEventListener("click",()=>{
        const isBlink= newPassword.type === 'text'

        if(isBlink){
            newPassword.type = 'password'; 
            eyeIcon.innerHTML='<i class="fa-solid fa-eye fa-sm">'
        }else{
            newPassword.type= 'text'
            eyeIcon.innerHTML = '<i class="fa-solid fa-eye-slash fa-sm"></i>'; 
        }
    })
</script>




<%- include('../partials/user/footer') %>
