<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>OTP Verification</title>
  <link rel="stylesheet" href="/css/verify-otp.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
</head>

<body>
  <div class="container">
    <h1>OTP Verification</h1>
    <p>Please enter the OTP sent to your email.</p>


   

    <form action="/verify-otp" method="POST" class="otp-form" onsubmit="return validateOTPForm(event)">
  <div class="otp-inputs">
    <input type="text" id="otp1" name="otp1" required>
  </div>
  <button type="submit">Verify OTP</button>
</form>

    <p class="timer">Resend OTP in <span id="countdown">30</span> seconds</p>
    <p class="resend">
      Didn't receive the OTP?
      <a href="/resend-otp" id="resend-link" class="disabled" onclick="return false;">Resend OTP</a>
    </p>
  </div>

  
  <script>// script.js
    document.addEventListener("DOMContentLoaded", function () {
      const countdownElement = document.getElementById("countdown");
      const resendLink = document.getElementById("resend-link");

      let timeLeft = 30; // 60 seconds countdown

      const timer = setInterval(function () {
        if (timeLeft <= 0) {
          clearInterval(timer);
          countdownElement.innerHTML = "0";
          resendLink.classList.remove("disabled");
          resendLink.classList.add("active");
          resendLink.onclick = function () {
            // Here, you could implement the logic to resend the OTP via AJAX or by navigating to a route.
            window.location.href = '/resend-otp'; // Example action
          };
        } else {
          countdownElement.innerHTML = timeLeft;
        }
        timeLeft -= 1;
      }, 1000);
    });

    function validateOTPForm(e) {
      console.log("on submit")
      e.preventDefault();

      const otpInput = document.getElementById("otp1").value

      $.ajax({
        type: "post",
        url: "verify-otp",
        data: { otp: otpInput },
        success: function (response) {

          if (response.success) {
            Swal.fire({
              icon: "success",
              title: "OTP verified Successfully",
              showConfirmButton: false,
              timer: 1500,
            }).then(() => {
              window.location.href = response.redirectUrl;
            })
          } else {
            Swal.fire({
              icon: "error",
              title: Error,
              text: response.message,


            })
          }
        },
        error: function () {
          Swal.fire({
            icon: "error",
            title: "invalid OTP",
            text: "try again",
          })
        }
      })
      return false;
    }




  </script>
</body>

</html>