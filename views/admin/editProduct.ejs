<%- include('../partials/admin/header') %>

<div id="page-wrapper">
    <div class="header">
      <h1 class="page-header">
        Edit Product
      </h1>
      <ol class="breadcrumb">
        <li><a href="#">Home</a></li>
        <li><a href="#">Forms</a></li>
        <li class="active">Data</li>
      </ol>

    </div>

    <div id="page-inner">
      <div class="row">
        <div class="col-lg-12">
          <div class="card">
            
            <div class="card-content">
                <form class="col s12" action="/admin/product/editProduct/<%= id %>" method="post" id="productForm">
                    <div class="row">
                      <div class="input-field col s12">
                        <input placeholder="Product Name" id="productName" type="text" class="validate" name="productName" value="<%= name %>">
                        <div id="error1" class="text-danger"></div>
                      </div>
                    </div>
                    
                    <div class="row">
                      <div class="input-field col s12">
                        <input placeholder="Description" id="pDiscription" type="text" class="validate" name="productDiscription" value="<%= description %>">
                        <div id="error2" class="text-danger"></div>
                      </div>
                    </div>
                  
                    <div class="row">
                      <div class="input-field col s12">
                        <input placeholder="Price" id="productPrice" type="number" class="validate" name="productPrice" value="<%= price %>">
                        <div id="error3" class="text-danger"></div>
                      </div>
                    </div>
                  
                    <div class="row">
                      <div class="input-field col s12">
                        
                        <select id="category" name="productCategory" style="display: inline-block;">
                          <option value="" disabled selected><%= find.categoryName %></option>
                          <% if(typeof allCategory !== 'undifined'){ %>

                            <% for(let i=0;i<allCategory.length;i++){ %>
                              <option value="<%= allCategory[i]._id %>"><%= allCategory[i].categoryName %></option>
                            <% } %>

                          <% } %>
                          
                          
                        </select>
                      </div>
                    </div>
                  
                    <div class="row">
                      <div class="input-field col s12">
                        <input placeholder="Product Image URL" id="product_image" type="file" class="validate" name="productImage">
                      </div>
                    </div>
                  
                    <div class="row">
                      <div class="col s12">
                        <div class="input-field inline">
                          <input placeholder="Size" id="size" type="text" class="validate" name="productSize" value="<%= size %>">
                        </div>
                        <div class="input-field inline">
                          <input placeholder="Color" id="color" type="text" class="validate" name="productColor" value="<%= color %>">
                        </div>
                        <div class="input-field inline">
                          <input placeholder="Stock" id="stock" type="number" class="validate" name="productStock" value="<%= stock %>">
                        </div>
                        <div>
                          <button type="submit" class="btn btn-success">edit product</button>
                        </div>
                      </div>
                    </div>
                  </form>
                  
              <div class="clearBoth"></div>
            </div>
          </div>
        </div>
      </div>
      
      <script>
        
        const productName=document.getElementById('productName');
        const productDiscription=document.getElementById('pDiscription')
        const productPrice=document.getElementById('productPrice')
        const productIimage=document.getElementById('productIimage')
        const error1=document.getElementById('error1')
        const error2=document.getElementById('error2')
        const error3=document.getElementById('error3')
        const error4=document.getElementById('error4')
        const form=document.getElementById('productForm')

        function nameValidation(){
          const nameVal=productName.value
          const namePattern=/^[A-Za-z\s&]+$/
          console.log("inside name validation "+nameVal)
          
          if(!namePattern.test(nameVal)){
            error1.innerHTML="name only contain caracters"
            return false
          }else{
            error1.innerHTML="";
            return true;
          }
          

        }

        function descriptionValidation(){
                const descrptionVal=productDiscription.value 
                
                if(descrptionVal.length>60){
                    error2.innerHTML="discription only allowed 60 caracters"
                    return false
                }else{
                    error2.innerHTML=""
                    return true
                }
        }
         
        function priceValidation(){

          const priceVal=parseFloat(productPrice.value) 

          console.log(typeof priceVal)
          if(priceVal<1){
            error3.innerHTML="enter a valid price"
            return false
          }else{
            error3.innerHTML='';
            return true;
          }
        }
        function imageValidation(){
          const fileLength=productIimage.files.length
          const allowedFile=3
          if(fileLength>allowedFile){
            error4.innerHTML="only allowed 3 image"
            return false
          }else if(fileLength<allowedFile){
            error4.innerHTML="need three images";
            return false
          }else{
            error4.innerHTML=""
            return true
          }
        }

        document.addEventListener("DOMContentLoaded",()=>{
          form.addEventListener("submit",(e)=>{
            const isName=nameValidation()
            const isDescription=descriptionValidation()
             const isPrice=priceValidation()
            // const isImage=imageValidation()

            if(!isName || !isDescription || !isPrice){
              e.preventDefault()
            }

          })
        })

      </script>
       
        <!-- /.panel-body -->
      </div>
      <!-- /.col-lg-12 -->
      <%- include('../partials/admin/footer') %>